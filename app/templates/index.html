<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OSS개론</title>

  <!-- 파비콘 -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />

  <!-- TailwindCSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .sr-only {
      position: absolute; width:1px; height:1px;
      padding:0; margin:-1px; overflow:hidden;
      clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }
    :root {
      --primary: #1D1D1F;
      --accent: #0070F3;
    }
  </style>
</head>
<body class="bg-white text-gray-900 font-sans antialiased">
  <div class="min-h-screen flex flex-col items-center justify-center px-4">

    <h1 class="text-3xl sm:text-4xl md:text-5xl font-semibold mb-8" style="color: var(--primary);">
      OSS개론
    </h1>

    <!-- 1) 입력폼 + 실시간 인기 뉴스 패널 -->
    <div class="w-full max-w-full sm:max-w-2xl lg:max-w-4xl flex flex-col lg:flex-row gap-6">
      
      <!-- 뉴스 요약 폼 -->
      <form id="summarize-form"
            class="flex-1 flex flex-col sm:flex-row items-center border-b-2 border-gray-300 focus-within:border-[var(--accent)]">
        <label for="url" class="sr-only">뉴스 URL 입력</label>
        <input type="url" id="url" name="url"
               placeholder="뉴스 URL을 여기에 붙여넣으세요" required
               class="flex-1 py-2 sm:py-3 px-3 sm:px-4 text-base sm:text-lg outline-none placeholder-gray-400" />
        <button type="submit" id="submit-button"
                class="mt-4 sm:mt-0 sm:ml-4 py-2 sm:py-3 px-4 sm:px-6 text-white font-medium rounded-2xl shadow-lg hover:opacity-90 transition"
                style="background-color: var(--accent)"
                aria-label="요약 요청">
          전송
        </button>
      </form>

      <!-- 실시간 인기 뉴스 패널 -->
      <aside id="trending-panel"
             class="w-full sm:w-64 bg-gray-50 rounded-2xl shadow p-4 flex flex-col
                    max-h-32 hover:max-h-screen overflow-hidden hover:overflow-visible
                    transition-all duration-300 ease-in-out">
        <h2 class="text-lg font-medium mb-3">실시간 인기 뉴스</h2>
        <ul id="trending-list" class="space-y-2">
          <!-- JS로 동적 채워짐 -->
        </ul>
        <p id="trending-time" class="mt-4 text-xs text-gray-500">
          마지막 업데이트: <time id="trending-updated-at">--:--:--</time>
        </p>
      </aside>
    </div>

    <!-- 2) 요약 결과 박스 -->
    <div id="summary-box" role="status" aria-live="polite" tabindex="-1"
         class="hidden mt-8 w-full max-w-full sm:max-w-2xl lg:max-w-4xl p-6 bg-gray-50 rounded-2xl shadow-xl 
                transform transition-all duration-500 ease-in-out opacity-0 translate-y-4">
      <h2 class="text-2xl font-medium mb-4" style="color: var(--primary);">요약 내용</h2>
      <p id="summary-text" class="text-base leading-relaxed"></p>
    </div>

    <footer class="mt-12 text-sm text-gray-500">&copy; 2025 OSS개론</footer>
  </div>

  <script>
    // 실시간 인기 뉴스 로드
    async function loadTrending() {
      try {
        const res = await fetch('/api/trending-news?top_n=5');
        const { trending } = await res.json();
        const ul = document.getElementById('trending-list');
        ul.innerHTML = trending.map((item, i) => `
          <li class="flex items-start">
            <div class="w-6 h-6 flex items-center justify-center 
                        ${['bg-blue-500','bg-blue-400','bg-blue-300','bg-blue-200','bg-blue-100'][i]}
                        ${i===4 ? 'text-gray-800' : 'text-white'} rounded-full text-sm flex-shrink-0">
              ${i+1}
            </div>
            <span class="ml-2">${item.title}</span>
          </li>
        `).join('');
        document.getElementById('trending-updated-at').textContent =
          new Date().toLocaleTimeString();
      } catch (e) {
        console.error('트렌딩 로드 실패', e);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadTrending();

      // 요약 폼 처리
      const form = document.getElementById('summarize-form');
      const btn  = document.getElementById('submit-button');
      const box  = document.getElementById('summary-box');
      const text = document.getElementById('summary-text');

      form.addEventListener('submit', async e => {
        e.preventDefault();
        btn.disabled = true;
        btn.textContent = '요약 중...';

        try {
          const url = document.getElementById('url').value;
          const res = await fetch('/api/summarize', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url })
          });
          const data = await res.json();
          text.textContent = data.summary;

          box.classList.remove('hidden');
          setTimeout(() => {
            box.classList.remove('opacity-0','translate-y-4');
            box.classList.add('opacity-100','translate-y-0');
            box.focus();
          }, 50);

          // 요약 후 트렌딩 갱신
          setTimeout(loadTrending, 300);
        } catch {
          alert('요약 중 오류가 발생했습니다.');
        } finally {
          btn.disabled = false;
          btn.textContent = '전송';
        }
      });
    });
  </script>
</body>
</html>
